"use strict";(()=>{var e={};e.id=5998,e.ids=[5998],e.modules={30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},57147:e=>{e.exports=require("fs")},71017:e=>{e.exports=require("path")},3376:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>b,originalPathname:()=>O,requestAsyncStorage:()=>x,routeModule:()=>w,serverHooks:()=>k,staticGenerationAsyncStorage:()=>S,staticGenerationBailout:()=>h});var a={};t.r(a),t.d(a,{POST:()=>y,runtime:()=>f}),t(95655);var s=t(83323),n=t(54647),i=t(71017),o=t.n(i),u=t(57147),p=t.n(u),l=t(69542);let f="nodejs",g=o().join(process.cwd(),"public","uploads");p().existsSync(g)||p().mkdirSync(g,{recursive:!0});let d=["image/jpeg","image/jpg","image/png","image/webp","image/gif"],c=[".jpg",".jpeg",".png",".webp",".gif"];async function y(e){try{let r=(0,l.H9)(e);if((0,l.Q)(r,10,6e4))return new Response(JSON.stringify({error:"\xc7ok fazla y\xfckleme. L\xfctfen bekleyin."}),{status:429});if(!(0,l.DK)(e)&&!(0,l.$8)(e))return new Response(JSON.stringify({error:"Yetkisiz dosya y\xfckleme."}),{status:401});let t=await e.formData(),a=t.get("file");if(!a)return new Response(JSON.stringify({error:"Dosya bulunamadı."}),{status:400});if(a.size>5242880)return new Response(JSON.stringify({error:"Dosya boyutu 5MB'dan b\xfcy\xfck olamaz."}),{status:400});if(!d.includes(a.type))return new Response(JSON.stringify({error:"Sadece resim dosyaları y\xfcklenebilir."}),{status:400});let s=o().extname(a.name).toLowerCase();if(!c.includes(s))return new Response(JSON.stringify({error:"Desteklenmeyen dosya uzantısı."}),{status:400});let n=await a.arrayBuffer(),i=Buffer.from(n),u=function(e,r){if(e.length<12)return!1;let t=e.subarray(0,12);switch(r){case"image/jpeg":case"image/jpg":return 255===t[0]&&216===t[1]&&255===t[2];case"image/png":return 137===t[0]&&80===t[1]&&78===t[2]&&71===t[3];case"image/gif":return 71===t[0]&&73===t[1]&&70===t[2];case"image/webp":return 82===t[0]&&73===t[1]&&70===t[2]&&70===t[3]&&87===t[8]&&69===t[9]&&66===t[10]&&80===t[11];default:return!1}}(i,a.type);if(!u)return new Response(JSON.stringify({error:"Ge\xe7ersiz dosya formatı."}),{status:400});let f=Date.now(),y=Math.random().toString(36).substring(2,8),m=o().parse(a.name).name.replace(/[^a-zA-Z0-9.-]/g,"_").replace(/\.+/g,".").replace(/^\.+|\.+$/g,"").toLowerCase(),w=`${f}-${y}-${m}${s}`,x=o().join(g,w);if(!x.startsWith(g))return new Response(JSON.stringify({error:"Ge\xe7ersiz dosya yolu."}),{status:400});p().writeFileSync(x,new Uint8Array(i));let S=`/uploads/${w}`;return new Response(JSON.stringify({url:S}),{status:200,headers:{"Content-Type":"application/json"}})}catch(e){return console.error("Upload error:",e),new Response(JSON.stringify({error:"Dosya y\xfckleme hatası."}),{status:500})}}let m=s.AppRouteRouteModule,w=new m({definition:{kind:n.x.APP_ROUTE,page:"/api/upload/route",pathname:"/api/upload",filename:"route",bundlePath:"app/api/upload/route"},resolvedPagePath:"/app/app/api/upload/route.ts",nextConfigOutput:"standalone",userland:a}),{requestAsyncStorage:x,staticGenerationAsyncStorage:S,serverHooks:k,headerHooks:b,staticGenerationBailout:h}=w,O="/api/upload/route"}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),a=r.X(0,[26405,69542],()=>t(3376));module.exports=a})();